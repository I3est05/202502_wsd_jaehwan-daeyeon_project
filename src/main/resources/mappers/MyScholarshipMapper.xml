<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.donjoogga.mapper.MyScholarshipMapper">

    <insert id="insertMyScholarship">
        INSERT INTO MyScholarship (
            user_id,
            scholar_id,
            is_api_data,
            saved_date
        ) VALUES (
                     #{userId},
                     #{scholarId},
                     #{isApiData},
                     NOW()
                 )
    </insert>

    <delete id="deleteMyScholarship">
        DELETE FROM MyScholarship
        WHERE user_id = #{userId} AND scholar_id = #{scholarId}
    </delete>

    <select id="selectMyScrapList" resultType="com.example.donjoogga.vo.Scholarship">
        SELECT
            M.scholar_id AS refId,      -- ✅ 핵심: Scholar 테이블이 아닌 MyScholarship의 ID를 우선 가져옴
            S.title,                    -- CSV 데이터일 경우 NULL로 넘어옴
            S.organization,             -- CSV 데이터일 경우 NULL로 넘어옴
            S.deadline,
            S.category,
            M.is_api_data AS isApiData, -- ✅ API 여부 확인을 위해 추가
            M.saved_date AS savedDate
        FROM MyScholarship M            -- ✅ MyScholarship을 기준으로 시작
                 LEFT JOIN Scholar S ON M.scholar_id = S.scholar_id -- ✅ LEFT JOIN으로 변경
        WHERE M.user_id = #{userId}
        ORDER BY M.saved_date DESC
    </select>

    <select id="checkScrapped" resultType="int">
        SELECT COUNT(*)
        FROM MyScholarship
        WHERE user_id = #{userId} AND scholar_id = #{scholarId}
    </select>


</mapper>